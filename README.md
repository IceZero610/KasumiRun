# KasumiRun
一个图一乐的基于PCR角色的赛马小游戏。

思路有一点但是不太清楚所以先写一个策划文档。

### 简单介绍一下游戏：

​	经典的随机赛马游戏。4匹马从起点开始，每回合向终点移动随机距离，先到终点的马获得胜利。

​	玩家无法干涉游戏的进行，在游戏开始前随机预测而已。

​	那么这次准备在这个机制的基础上引入PCR的角色，并在对局中施放各种技能增加戏剧性。

## 游戏运行

Python Game.py

## 目前等待完成的点：

- 技能发动的提示信息比较弱智。可能需要更好的办法来提示
- 美化进度界面
- 更友好的交互型角色生成器
- 有些状态效果还没有做出来
- 等角色设计齐4个后，在chara文件夹中随机挑选4个参加比赛
- 平衡性调整与平衡模型的建立



### 关键的几个系统：

#### 动态随机前进：

​	让普通速度的移动更加均衡，避免连续地高速前进这种事情发生。

​	下面的代码块可以算出动态随机的期望。暂定是(3格/5格)的前进模式。显示的话应该是三格显示为一个字符……？。显示是16格。即48步

```python
import random
class DynamicRandom:
    def __init__(self, prob):
        self.curr_prob = prob
        self.prob = prob
    
    def getRandom(self):
        if random.random() < self.curr_prob:
            self.curr_prob = self.prob
            return 1
        else:
            self.curr_prob += self.prob
            return 0
        
a = DynamicRandom(0.056)
S = 0
for i in range(500000):
    S += a.getRandom()

print(S/500000)
```



==**高亮：** 由于动态随机移动很难拉开差距所以放弃把这个动态随机系统用在常规移动中，转而用在技能的施放中，以此提高技能释放的稳定度。实现的方法也有微小区别，请注意getSkillRandom()函数==

现在移动类似于马趴投色子，在list中随机choice

#### TP系统：

​	TP不显示在游戏中，作为隐藏数值。

​	TP超过200时，必定发动UB，然后直接清零。

​	UB尽量保证每局每人基本能放出来一次，可以稍微少一点()

​	小技能暂时没有想好是否消耗TP，就算是消耗应该也不会太多，技能下面有专门说明。

​	TP的回复机制：

- 开局每个角色初始随机获得较少的TP       范围暂定[10, 40] 
- (↑) 也许可以在开赛前让玩家助威增加初始值什么的……
- 每次行动回复随机值                    范围暂定[12, 28]
  考虑是这样的：总共16个字符，48格，前进速度按照4格每回合算(会有加速技能，实际正常前进的期望应该要小)，大约要进行12回合的样子，期望20的话，差不多9个回合可以开出来，算上下面的受击加成，可能会更少一点。具体数值还会做调整
- UB的强度应该约等于让自己单独【前进9格】的效果，请参考这个强度设计UB，十分不鼓励针对单个角色的过强的debuff设计。
- 为了避免UB齐发的情况，增加下面的效果，如果有必要的话可能还要把行动回复TP的方差增大：
- 被负面技能影响到的角色会获得补偿的TP值，具体的数值应该写在技能里。  ~~这个数值脑算觉得在25~35之间比较合理。等待测试，尽量避免出现挨打反而赚的情况~~     (   好吧确实高了，考虑还是直接算作一次行动的收益就好了)
- 所以感觉小技能需要消耗TP啊()

#### 技能系统

​	**一个技能应该包含哪些信息？**

​	【技能名】【技能说明】【TP消耗】【发动概率】【剩余发动次数】【冷却时间】【效果类型 + 效果详细】

​	**这个效果类型和详细需要什么呢？**

​	效果类型应该是一个常量。(字符串或者是整形，考虑可读性应该是用字符串了)

​	某个技能可能会由下面的多个效果叠加，应该是个数组的形式存储

​	这里先列一些可能会用到的效果，然后需要传入一个数组，里面是需要用到的参数，具体的每个参数会因为技能效果类型的不同而有区别。之所以这样设计主要是为了方便Json的读写，我会在接下来的[规范文档](./效果列表.md)中详细地写出效果类型和参数数组的每个位置数字的意义：	

- 加速：持续几回合，取三次步数随机池，取最大值
- 前进：直接地前进指定格数
- 击退：目标后退指定格数
- 沉默：目标几回合内不能施放任何技能
- 护盾：几回合内免受击退、沉默、击晕的效果，不能抵抗减速，抵抗之后立即失效
- 减速：持续几回合，取三次步数随机池，取最小值
- 击晕：当前回合，不能常规移动，但是TP会正常增加
- 窃取：减少目标的TP，增加自己的TP(这两个数值可以不相等)

#### 角色系统

​	角色的初始参数应该可以直接从json文件中读取。

​	一个角色类应该有什么信息？	

​	【角色名】【角色图标】【角色默认移动速度(动态基础概率)】【角色技能】   此外，角色还需要有一个map用来记录当前的【状态信息】，每个状态信息应该由状态类型的字符串和剩余持续时间决定，还有【当前TP值】

​	其中每个角色技能里应该有上面提到的信息，其中最后一项应该是一个数组，数组的每个元素都包含效果类型和参数数组。遍历这个效果的数组，就可以把技能的全部效果执行一遍。

#### 回合模式：

​	一个回合应该依次执行下面的步骤：

1. 处理全部状态效果，使其生效，并持续时间-1。
2. 所有角色根据技能的概率随机发动技能，优先判断是否有UB，之后再判断技能1是否发动，若技能1发动则不会发动技能2，只有技能1没有发动的情况下才会判断技能2是否发动。这个阶段角色只可能发动一个技能。
3. 结算部分有即时效果的技能
4. 检查是否有人到达终点
5. 角色常规移动
6. 检查是否有人到达终点